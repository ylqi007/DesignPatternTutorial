# Decorator Pattern (è£…é¥°è€…æ¨¡å¼)
è£…é¥°è€…æ¨¡å¼ä¹Ÿç§°ä¸ºåŒ…è£…æ¨¡å¼(Wrapper Pattern), å±äºç»“æ„å‹è®¾è®¡æ¨¡å¼ã€‚
ä»**åŠŸèƒ½**ä¸Šè€Œè¨€ï¼Œdecoratorèƒ½å¾ˆå¥½çš„æè¿°è¿™ä¸ªæ¨¡å¼ï¼Œä½†æ˜¯ä»**ç»“æ„**ä¸Šçœ‹ï¼Œwrapperçš„è¯´æ³•æ›´åŠ è´´åˆ‡ã€‚è£…é¥°è€…æ¨¡å¼å°†ä¸€ä¸ªå¯¹è±¡åµŒå…¥åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¹‹ä¸­ï¼Œå®é™…ä¸Šç›¸å½“äºè¿™ä¸ªå¯¹è±¡è¢«å¦ä¸€ä¸ªå¯¹è±¡åŒ…è£…èµ·æ¥ï¼Œå½¢æˆäº†ä¸€æ¡åŒ…è£…é“¾ã€‚è¯·æ±‚éšç€è¿™æ¡é“¾ä¾æ¬¡ä¼ é€’åˆ°æ‰€æœ‰çš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰å¤„ç†è¿™æ¡è¯·æ±‚çš„æœºä¼šã€‚
![](images/DecoratorPattern_CoffeeExample.png)


## æ¨¡å¼åŠ¨æœº & å®šä¹‰
### 1. åŠ¨æœº
è¦å®ç°ç»™ä¸€ä¸ªç±»orå¯¹è±¡å¢åŠ è¡Œä¸ºï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼
1. ç»§æ‰¿æœºåˆ¶: é€šè¿‡ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå¯ä»¥ä½¿å­ç±»åœ¨æ‹¥æœ‰è‡ªèº«æ–¹æ³•çš„åŒæ—¶è¿˜æ‹¥æœ‰çˆ¶ç±»çš„æ–¹æ³•ã€‚ä½†è¿™ç§æ–¹æ³•æ˜¯**é™æ€çš„**ï¼Œç”¨æˆ·ä¸èƒ½æ§åˆ¶å¢åŠ è¡Œä¸ºçš„æ–¹å¼å’Œæ—¶æœºã€‚(é«˜è€¦åˆï¼Œä¼šäº§ç”Ÿæ›´å¤šçš„å­ç±»ï¼Œä»è€Œå¼•èµ·ç±»çˆ†ç‚¸)
2. å…³è”æœºåˆ¶: å°†ä¸€ä¸ªç±»å¯¹è±¡åµŒå…¥åˆ°å¦ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œç”±å¦ä¸€ä¸ªå¯¹è±¡å†³å®šæ˜¯å¦è°ƒç”¨åµŒå…¥å¯¹è±¡çš„è¡Œä¸ºä»¥ä¾¿æ‰©å±•è‡ªå·±çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªè¢«åµŒå…¥çš„å¯¹è±¡ä¸ºè£…é¥°å™¨(Decorator)ã€‚(é™è€¦ï¼Œä¸ä¼šåˆ›é€ æ›´å¤šçš„å­ç±»)

è£…é¥°æ¨¡å¼å¯ä»¥å¯¹å®¢æˆ·é€æ˜åœ°ã€åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡é™„åŠ ä¸Šæ›´å¤šçš„è´£ä»»ï¼Œæ¢è¨€ä¹‹ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šè§‰å¾—å¯¹è±¡åœ¨è£…é¥°å‰å’Œè£…é¥°åç”±ä»€ä¹ˆä¸åŒã€‚è£…é¥°æ¨¡å¼å¯ä»¥åœ¨ä¸éœ€è¦åˆ›é€ æ›´å¤šå­ç±»çš„æƒ…å†µä¸‹ï¼Œå°†å¯¹è±¡çš„åŠŸèƒ½åŠ ä»¥æ‰©å±•ã€‚

### 2. å®šä¹‰
è£…é¥°æ¨¡å¼(Decorator Pattern): åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„èŒè´£(Responsibility)ï¼Œå°±å¢åŠ å¯¹è±¡åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»ï¼ˆç»§æ‰¿ï¼‰å®ç°æ›´ä¸ºçµæ´»ã€‚å…¶åˆ«åä¹Ÿå¯ä»¥ç§°ä¸ºåŒ…è£…å™¨(Wrapper)ï¼Œä¸é€‚é…å™¨æ¨¡å¼çš„åˆ«åç›¸åŒï¼Œä½†å®ƒä»¬é€‚ç”¨äºä¸åŒçš„åœºåˆã€‚


## è£…é¥°æ¨¡å¼ç»“æ„
![](images/Decorator.Structure.png)
1. **éƒ¨ä»¶(Component):** å£°æ˜**å°è£…å™¨**å’Œ**è¢«å°è£…å¯¹è±¡**çš„å…¬ç”¨æ¥å£ã€‚
2. **å…·ä½“éƒ¨ä»¶(Concrete Component):** è¢«å°è£…å¯¹è±¡æ‰€å±çš„ç±»ã€‚å®ƒå®šä¹‰äº†åŸºç¡€è¡Œä¸ºï¼Œä½†è£…é¥°ç±»å¯ä»¥æ”¹å˜è¿™äº›è¡Œä¸ºã€‚
3. **åŸºç¡€è£…é¥°(Base Decorator):** æ‹¥æœ‰ä¸€ä¸ªæŒ‡å‘è¢«å°è£…å¯¹è±¡çš„å¼•ç”¨æˆå‘˜å˜é‡ã€‚è¯¥å˜é‡çš„ç±»å‹è¢«å£°æ˜ä¸ºé€šç”¨çš„éƒ¨ä»¶æ¥å£ï¼Œè¿™æ ·å®ƒå¯ä»¥åº”ç”¨å…·ä½“çš„éƒ¨ä»¶å’Œè£…é¥°ã€‚è£…é¥°å™¨åŸºç±»ä¼šå°†æ‰€æœ‰çš„æ“ä½œå§”æ´¾ç»™è¢«å°è£…çš„å¯¹è±¡ã€‚
4. **å…·ä½“è£…é¥°(Concrete Decorators):** å®šä¹‰äº†å¯ä»¥åŠ¨æ€æ·»åŠ åˆ°éƒ¨ä»¶çš„é¢å¤–è¡Œä¸ºã€‚å…·ä½“è£…é¥°ç±»ä¼šé‡å†™åŸºç¡€è£…é¥°ç±»çš„æ–¹æ³•ï¼Œå¹¶åœ¨è°ƒç”¨çˆ¶ç±»æ–¹æ³•ä¹‹å‰æˆ–ä¹‹åè¿›è¡Œé¢å¤–çš„è¡Œä¸ºã€‚
5. **å®¢æˆ·ç«¯(Client):** å¯ä»¥ä½¿ç”¨å¤šå±‚è£…é¥°å°è£…éƒ¨ä»¶ï¼Œåªè¦å®ƒèƒ½å¤Ÿä½¿ç”¨é€šç”¨æ¥å£ä¸æ‰€æœ‰å¯¹è±¡äº’åŠ¨å³å¯ã€‚


## è£…é¥°æ¨¡å¼é€‚ç”¨åœºæ™¯
1. å¦‚æœä½ å¸Œæœ›åœ¨æ— éœ€ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹å³å¯ä½¿ç”¨å¯¹è±¡ï¼Œ ä¸”å¸Œæœ›åœ¨è¿è¡Œæ—¶ä¸ºå¯¹è±¡æ–°å¢é¢å¤–çš„è¡Œä¸ºï¼Œ å¯ä»¥ä½¿ç”¨è£…é¥°æ¨¡å¼ã€‚
2. è£…é¥°èƒ½å°†ä¸šåŠ¡é€»è¾‘ç»„ç»‡ä¸ºå±‚æ¬¡ç»“æ„ï¼Œ ä½ å¯ä¸ºå„å±‚åˆ›å»ºä¸€ä¸ªè£…é¥°ï¼Œ åœ¨è¿è¡Œæ—¶å°†å„ç§ä¸åŒé€»è¾‘ç»„åˆæˆå¯¹è±¡ã€‚ ç”±äºè¿™äº›å¯¹è±¡éƒ½éµå¾ªé€šç”¨æ¥å£ï¼Œ å®¢æˆ·ç«¯ä»£ç èƒ½ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨è¿™äº›å¯¹è±¡ã€‚
3. å¦‚æœç”¨ç»§æ‰¿æ¥æ‰©å±•å¯¹è±¡è¡Œä¸ºçš„æ–¹æ¡ˆéš¾ä»¥å®ç°æˆ–è€…æ ¹æœ¬ä¸å¯è¡Œï¼Œ ä½ å¯ä»¥ä½¿ç”¨è¯¥æ¨¡å¼ã€‚
4. è®¸å¤šç¼–ç¨‹è¯­è¨€ä½¿ç”¨`final`å…³é”®å­—æ¥é™åˆ¶å¯¹æŸä¸ªç±»çš„è¿›ä¸€æ­¥æ‰©å±•ã€‚ å¤ç”¨æœ€ç»ˆç±»å·²æœ‰è¡Œä¸ºçš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨è£…é¥°æ¨¡å¼ï¼š ç”¨å°è£…å™¨å¯¹å…¶è¿›è¡Œå°è£…ã€‚


## è£…é¥°æ¨¡å¼åœ¨Java IOä¸­çš„åº”ç”¨
`InputStream`ç±»å›¾
![](images/DecoratorPattern.InputStream.png)

`OutputStream`ç±»å›¾
![](images/DecoratorPattern.OutputStream.png)

`Reader` and `Writer` ç±»å›¾
![](images/DecoratorPattern.Reader.png)
![](images/DecoratorPattern.Writer.png)


## è£…é¥°è€…æ¨¡å¼ ğŸ†š ä»£ç†æ¨¡å¼
è¿™ä¸¤ç§æ¨¡å¼éƒ½æè¿°äº†ä¸ºå¯¹è±¡æä¾›ä¸€å®šç¨‹åº¦ä¸Šçš„é—´æ¥å¼•ç”¨ï¼Œå®ƒä»¬çš„å®ç°éƒ¨åˆ†éƒ½ä¿ç•™äº†å¯¹å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”å‘é‚£ä¸ªå¯¹è±¡å‘é€è¯·æ±‚ã€‚

**åŒºåˆ«:**
* **ä»£ç†æ¨¡å¼**ç›®çš„æ˜¯ï¼Œå½“ç›´æ¥è®¿é—®æœ¬åœ°ä¸æ–¹ä¾¿orä¸ç¬¦åˆéœ€æ±‚æ—¶ï¼Œä¸ºè¿™ä¸ªæœ¬åœ°æä¾›äº†ä¸€ä¸ªæ›¿ä»£è€…ã€‚**æœ¬ä½“**å®šä¹‰äº†å…³é”®åŠŸèƒ½ï¼Œè€Œ**ä»£ç†**æä¾›oræ‹’ç»å¯¹å®ƒçš„è®¿é—®ï¼Œæˆ–è€…**åœ¨è®¿é—®æœ¬ä½“ä¹‹å‰åšä¸€äº›é¢å¤–çš„äº‹æƒ…**ã€‚
* **è£…é¥°è€…æ¨¡å¼**çš„ä½œç”¨å°±æ˜¯ä¸ºå¯¹è±¡**åŠ¨æ€åŠ å…¥è¡Œä¸º**ã€‚

**ä»£ç†æ¨¡å¼**é€šå¸¸æ˜¯ä¸€å±‚ä»£ç†-->æœ¬ä½“çš„å¼•ç”¨ï¼Œè€Œ**è£…é¥°è€…æ¨¡å¼**ç»å¸¸ä¼šå½¢æˆä¸€æ¡æ¡é•¿é•¿çš„è£…é¥°é“¾ã€‚


## Reference
* [è£…é¥°æ¨¡å¼](https://refactoringguru.cn/design-patterns/decorator)
* [ç§’æ‡‚è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼ï¼ˆDecorator Patternï¼‰](https://shusheng007.top/2020/02/16/decorator-pattern/)
* :white_check_mark:[è®¾è®¡æ¨¡å¼ | è£…é¥°è€…æ¨¡å¼åŠå…¸å‹åº”ç”¨](https://juejin.cn/post/6844903681322647566)  (è£…é¥°æ¨¡å¼åœ¨Java IOä¸­çš„åº”ç”¨ï¼Œä»¥åŠåœ¨Spring cache, Spring session, Mybatisç¼“å­˜ä¸­çš„åº”ç”¨)
* [è£…é¥°æ¨¡å¼â€”â€”çœ‹ JDK å’Œ Spring æ˜¯å¦‚ä½•æœç»ç»§æ‰¿æ»¥ç”¨çš„](https://ost.51cto.com/posts/682)
* [3. è£…é¥°æ¨¡å¼](https://design-patterns.readthedocs.io/zh-cn/latest/structural_patterns/decorator.html)
* [ã€javaè®¾è®¡æ¨¡å¼ã€‘ï¼ˆ5ï¼‰---è£…é¥°è€…æ¨¡å¼ï¼ˆæ¡ˆä¾‹è§£æï¼‰](https://www.cnblogs.com/qdhxhz/p/9251083.html)
* [Java è®¾è®¡æ¨¡å¼ä¹‹è£…é¥°è€…æ¨¡å¼](https://segmentfault.com/a/1190000016508992)
* [è®¾è®¡æ¨¡å¼ --è£…é¥°è€…æ¨¡å¼](https://github.com/aermin/blog/issues/68)
* [è£…é¥°è€…æ¨¡å¼(Decorator) ](https://leezhian.com/web/design/decorator)
* [è®¾è®¡æ¨¡å¼ä¸­çš„ä¿„ç½—æ–¯å¥—å¨ƒï¼šè£…é¥°è€…ï¼ˆDecoratorï¼‰æ¨¡å¼](https://xxgblog.com/2021/10/19/decorator-pattern/) (HttpServletRequestå¥—å¨ƒ)
* [èŠä¸€èŠè£…é¥°è€…æ¨¡å¼](https://www.51cto.com/article/740706.html)
* [è®¾è®¡æ¨¡å¼--è£…é¥°è€…æ¨¡å¼](https://www.jianshu.com/p/a11de1059145)
* [ä»€ä¹ˆæ˜¯è£…é¥°è€…æ¨¡å¼](https://coderunning.fun/2019/12/07/design-pattern/%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/)
* [è®¾è®¡æ¨¡å¼â€”â€”3ã€è£…é¥°è€…æ¨¡å¼](http://zjwave.com/article/44.html)
* [è£…é¥°è€…æ¨¡å¼](https://gentryhuang.com/posts/a708a60d/)